#!/usr/bin/env perl
# Copyright (c) 2018-present The Alive2 Authors.
# Distributed under the MIT license that can be found in the LICENSE file.

use warnings;
use strict;
use autodie;

foreach my $file (@ARGV) {
    print "processing '${file}'\n";
    my $output = "";
    my @todelete = ();
    open my $inf, "<$file" or die;
    while (my $line = <$inf>) {
        if ($line =~ /^include\(\"(.+)\"\)$/) {
            my $temp = $1;
            push @todelete, $temp;
            open my $inf2, "<$temp" or die;
            while (my $line2 = <$inf2>) {
                $output .= $line2;
            }
            close $inf2;
        } else {
            $output .= $line;
        }
    }
    close $inf;
    open my $outf, ">$file" or die;
    print $outf $output;
    close $outf;
    unlink(@todelete);
}
